10 REM Jeu 2048 pour ZX81
20 DIM T(4)
30 DIM E(16)
40 LET S=0
50 DIM B(4,4)
60 DIM A(4,4)
70 GOSUB 1000 ' Initialiser le plateau
80 GOSUB 2000 ' Afficher le plateau
90 FOR I=1 TO 4: FOR J=1 TO 4: LET B(I,J)=A(I,J): NEXT J: NEXT I
100 INPUT "Votre mouvement (Z=Haut, S=Bas, Q=Gauche, D=Droite): "; M$
110 IF M$="Z" THEN GOSUB 3000
120 IF M$="S" THEN GOSUB 4000
130 IF M$="Q" THEN GOSUB 5000
140 IF M$="D" THEN GOSUB 6000
150 LET C=0
160 FOR I=1 TO 4: FOR J=1 TO 4: IF A(I,J)<>B(I,J) THEN LET C=1: GOTO 180
170 NEXT J: NEXT I
180 IF C=1 THEN GOSUB 7000 ' Ajouter une nouvelle tuile
190 GOSUB 8000 ' Vérifier si le jeu est terminé
200 GOTO 80

1000 REM Initialiser le plateau
1010 FOR I=1 TO 4
1020 FOR J=1 TO 4
1030 LET A(I,J)=0
1040 NEXT J
1050 NEXT I
1060 GOSUB 7000 ' Ajouter une tuile
1070 GOSUB 7000 ' Ajouter une autre tuile
1080 RETURN

2000 REM Afficher le plateau
2010 CLS
2020 PRINT "Score: "; S
2030 PRINT
2040 FOR I=1 TO 4
2050 FOR J=1 TO 4
2060 IF A(I,J)=0 THEN GOTO 2065
2061 PRINT A(I,J);
2062 GOTO 2070
2065 PRINT ".";
2070 PRINT " ";
2080 NEXT J
2090 PRINT
2100 NEXT I
2110 RETURN

3000 REM Mouvement vers le haut
3010 FOR J=1 TO 4
3020 LET N=0
3030 FOR I=1 TO 4
3040 IF A(I,J)<>0 THEN LET N=N+1: LET T(N)=A(I,J)
3050 NEXT I
3060 LET I=1
3065 GOTO 3075
3070 LET I=I+1
3075 IF I>N THEN GOTO 3100
3080 IF I<N THEN IF T(I)=T(I+1) THEN LET T(I)=T(I)*2: LET S=S+T(I): FOR K=I+1 TO N-1: LET T(K)=T(K+1): NEXT K: LET N=N-1: GOTO 3075
3090 GOTO 3070
3100 FOR I=1 TO 4
3105 IF I<=N THEN LET A(I,J)=T(I): GOTO 3115
3110 LET A(I,J)=0
3115 NEXT I
3130 NEXT J
3140 RETURN

4000 REM Mouvement vers le bas
4010 FOR J=1 TO 4
4020 LET N=0
4030 FOR I=4 TO 1 STEP -1
4040 IF A(I,J)<>0 THEN LET N=N+1: LET T(N)=A(I,J)
4050 NEXT I
4060 LET I=1
4065 GOTO 4075
4070 LET I=I+1
4075 IF I>N THEN GOTO 4100
4080 IF I<N THEN IF T(I)=T(I+1) THEN LET T(I)=T(I)*2: LET S=S+T(I): FOR K=I+1 TO N-1: LET T(K)=T(K+1): NEXT K: LET N=N-1: GOTO 4075
4090 GOTO 4070
4100 FOR I=4 TO 1 STEP -1
4105 IF 4-I+1<=N THEN LET A(I,J)=T(4-I+1): GOTO 4115
4110 LET A(I,J)=0
4115 NEXT I
4130 NEXT J
4140 RETURN

5000 REM Mouvement vers la gauche
5010 FOR I=1 TO 4
5020 LET N=0
5030 FOR J=1 TO 4
5040 IF A(I,J)<>0 THEN LET N=N+1: LET T(N)=A(I,J)
5050 NEXT J
5060 LET J=1
5065 GOTO 5075
5070 LET J=J+1
5075 IF J>N THEN GOTO 5100
5080 IF J<N THEN IF T(J)=T(J+1) THEN LET T(J)=T(J)*2: LET S=S+T(J): FOR K=J+1 TO N-1: LET T(K)=T(K+1): NEXT K: LET N=N-1: GOTO 5075
5090 GOTO 5070
5100 FOR J=1 TO 4
5105 IF J<=N THEN LET A(I,J)=T(J): GOTO 5115
5110 LET A(I,J)=0
5115 NEXT J
5130 NEXT I
5140 RETURN

6000 REM Mouvement vers la droite
6010 FOR I=1 TO 4
6020 LET N=0
6030 FOR J=4 TO 1 STEP -1
6040 IF A(I,J)<>0 THEN LET N=N+1: LET T(N)=A(I,J)
6050 NEXT J
6060 LET J=1
6065 GOTO 6075
6070 LET J=J+1
6075 IF J>N THEN GOTO 6100
6080 IF J<N THEN IF T(J)=T(J+1) THEN LET T(J)=T(J)*2: LET S=S+T(J): FOR K=J+1 TO N-1: LET T(K)=T(K+1): NEXT K: LET N=N-1: GOTO 6075
6090 GOTO 6070
6100 FOR J=4 TO 1 STEP -1
6105 IF 4-J+1<=N THEN LET A(I,J)=T(4-J+1): GOTO 6115
6110 LET A(I,J)=0
6115 NEXT J
6130 NEXT I
6140 RETURN

7000 REM Ajouter une nouvelle tuile
7010 LET N=0
7020 FOR I=1 TO 4
7030 FOR J=1 TO 4
7040 IF A(I,J)=0 THEN LET N=N+1: LET E(N)=I*10+J
7050 NEXT J
7060 NEXT I
7070 IF N=0 THEN RETURN
7080 LET R1=RND
7090 LET R=INT(R1*N)+1
7100 LET I=INT(E(R)/10)
7110 LET J=E(R)-I*10
7115 LET R2=RND
7120 IF R2<0.9 THEN LET A(I,J)=2
7130 IF R2>=0.9 THEN LET A(I,J)=4
7140 RETURN

8000 REM Vérifier si le jeu est terminé
8010 FOR I=1 TO 4
8020 FOR J=1 TO 4
8030 IF A(I,J)=0 THEN RETURN
8040 IF I<4 THEN IF A(I,J)=A(I+1,J) THEN RETURN
8050 IF J<4 THEN IF A(I,J)=A(I,J+1) THEN RETURN
8060 NEXT J
8070 NEXT I
8080 PRINT "Jeu terminé ! Votre score : "; S
8090 STOP
8100 RETURN